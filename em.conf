#Configuration file for NAMD simulations
#Build by Alexandre Suman de Araujo: alexandre.suman@unesp.br
#September 2021

#############################################################
## JOB DESCRIPTION                                         ##
#############################################################

# This is what this job does
set restart_job 0
set do_pbc 1
set do_pme 1
set do_lgv_pressure 1
set do_freeze 0
set do_restraints 0
set do_imd 0
set do_minimize 1
set do_md 0
set do_abf 0
set do_metadyn 0
set do_ramd 0
set temperature 298
set pressure 1.01325  ;#1 atm in bar
set basename IMPUT_NAME
set inputname IMPUT_NAME
set outputname em
set em_steps 15000
set md_steps 5000000


#############################################################
## ADJUSTABLE PARAMETERS                                   ##
#############################################################

structure          $basename.psf
coordinates        $basename.pdb
outputName         $outputname
binaryoutput yes

# Continuing a job from the restart files
if {$restart_job} {
binCoordinates     $inputname.coor
binVelocities      $inputname.vel  ;# remove the "temperature" entry if you use this!
extendedSystem	   $inputname.xsc
} else {
temperature $temperature
}

firsttimestep      0


#############################################################
## SIMULATION PARAMETERS                                   ##
#############################################################

# Input
paraTypeCharmm	    on
parameters          toppar_water_ions.str
parameters          par_all36_lipid.prm
parameters          par_all36m_prot.prm

# Periodic Boundary conditions
# NOTE: Do not set the periodic cell basis if you have also 
# specified an .xsc restart file!
if {$do_pbc && !$restart_job} { 
cellBasisVector1    XX.    0.   0.
cellBasisVector2     0.   YY.   0.
cellBasisVector3     0.    0.  ZZ.
cellOrigin           0 0 0
}
wrapWater           on
wrapAll             on

# Force-Field Parameters
exclude             scaled1-4
1-4scaling          1.0
cutoff              12.
switching           on
switchdist          10.
pairlistdist        14.


# Integrator Parameters
timestep            2.0  ;# 2fs/step
rigidBonds          all  ;# needed for 2fs steps
nonbondedFreq       1
fullElectFrequency  4
stepspercycle       20
pairlistsPerCycle   2


#PME (for full-system periodic electrostatics)
if {$do_pme} {
PME                 yes
PMEGridSpacing      1.0
}


# Constant Temperature Control
langevin            on    ;# do langevin dynamics
langevinDamping     1     ;# damping coefficient (gamma) of 5/ps
langevinTemp        $temperature   ;#$temperature
langevinHydrogen    no    ;# don't couple langevin bath to hydrogens


# Constant Pressure Control (variable volume)
if {$do_lgv_pressure} {
useGroupPressure      yes ;# needed for 2fs steps
useFlexibleCell       yes  ;# no for water box, yes for membrane
useConstantArea       yes  ;# no for water box, yes for membrane

langevinPiston        on
langevinPistonTarget  $pressure ;#  in bar -> 1 atm
langevinPistonPeriod  200.
langevinPistonDecay   100.
langevinPistonTemp    $temperature
}

#Output options
restartfreq         1000     ;# write restart files every 10000 steps = 20ps
dcdfreq             1000     ;# write trajectory file every 5000 steps = 10ps 
veldcdfreq          1000     ;# write velocities files every 5000 steps = 10ps 
xstFreq             1000     ;# write system extension files every 5000 steps = 10ps 
outputEnergies      1000    ;# write energies to output file every 5000 steps = 10ps 
outputPressure      1000    ;# write pressure to output file every 5000 steps = 10ps 
outputtiming        1000    ;# write time statistics to output file every 5000 steps = 10ps 

# Fixed Atoms Constraint (set PDB beta-column to 1)
if {$do_freeze} {
fixedAtoms          on
fixedAtomsFile      myfixedatoms.pdb
fixedAtomsCol       B
}

# Apply Harmonic Restraints to selected atoms
if {$do_restraints} {
constraints         on
consref             restraint.pdb     ;# PDB file with equilibrium position of restrained atoms
conskfile           restraint.pdb     ;# PDB file with k constant of the restraint
conskcol            B                 ;# Column of the PDB file that defines the value of k for each restrained atom
                                       # Atoms with not restraint needs to have 0 in this column
}

# IMD Settings (can view sim in VMD)
if {$do_imd} {
IMDon           on
IMDport         3000    ;# port number (enter it in VMD)
IMDfreq         1       ;# send every 1 frame
IMDwait         no      ;# wait for VMD to connect before running?
}

# ABF Settings
if {$do_abf} {
colvars              on
colvarsConfig        colvar_abf.conf
}

# METADYNAMICS Settings
if {$do_metadyn} {
colvars on
#colvarsInput metadyn_01              # Needed to reinitialize simulations
colvarsConfig colvar_metadyn.conf # colective variable configuration file
}

# RAMD (Random acceleration molecular dynamics) Settings
if {$do_ramd} {

# RAMD setup stuffs
source /scratch/app/namd/2.12-ibverbs-CUDA/lib/ramd/scripts/ramd-4.1.tcl                 

ramd debugLevel                       0
#activates verbose output if set to something else than 0
ramd ramdSteps                       50
#specifies the number of steps in 1 ramd stint defaults to 50
ramd accel                            0.075
#specifies the acceleration to be applied. defaults to 0.25 kcal/mol*A*amu
ramd rMinRamd                         0.1
#specifies the minimum distance to be travelled by the ligand in 1 ramd stint defaults to 0.01 Angstr 
ramd forceOutFreq                    50
#every 'forceOutFreq' steps detailed output of forces will be written defaults to 0 (no detailed output)
ramd maxDist                         50
#specifies the distance between the COMs of the ligand and the protein when the simulation is stopped defaults to 50 Angstr
ramd ramdSeed                     RRRRR
#specifies the seed for the random number generator (for the generation of acceleration directions)


#Defining molecules (required!)
ramd firstProtAtom                    1
#specifies the index of the first protein atom
ramd lastProtAtom                  2572
#specifies the index of the last protein atom

ramd firstRamdAtom                 2573
#specifies the index of the first ligand atom
ramd lastRamdAtom                  2614
#specifies the index of the last ligand atom

}

#############################################################
## EXECUTION SCRIPT                                        ##
#############################################################

# Minimization
if {$do_minimize} {
minimize            $em_steps
reinitvels          $temperature
}

# MD
if {$do_md} {
run $md_steps
}




	
